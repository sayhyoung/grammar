<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë¬¸ë²• ë¬¸ì œ ìƒì„±ê¸° - ìœ¤ì„ ìƒ AI ì‹¤í—˜ì‹¤</title>
  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8a7a7;
      line-height: 1.6;
    }
    header {
      background-color: #333333;
      color: #fafafa;
      padding: 15px 10px;
      text-align: center;
    }
    main {
      padding: 20px;
      max-width: 1000px;
      margin: 20px auto;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    footer {
      background-color: #333;
      color: #fff;
      text-align: center;
      padding: 10px;
      margin-top: 20px;
    }
    footer img {
      vertical-align: middle;
      margin-left: 10px;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ íƒ­ ë©”ë‰´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tab-btn {
      padding: 10px 20px;
      border: 1px solid #ccc;
      cursor: pointer;
      background-color: #fff;
      margin: 0 5px;
      border-radius: 4px 4px 0 0;
    }
    .tab-btn.active {
      background-color: #1c87c9;
      color: #fff;
      border-bottom: none;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì„¹ì…˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    form {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      max-width: 600px;
      margin: auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fafafa;
    }
    form label {
      font-weight: bold;
    }
    form select,
    form button {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    form button {
      background-color: #1c87c9;
      color: #fff;
      cursor: pointer;
      border: none;
    }
    form button:hover {
      background-color: #155d8b;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¬¸ì œÂ·ì •ë‹µ ì˜ì—­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #output,
    #answerSection {
      max-width: 600px;
      margin: 20px auto;
      padding: 15px;
      background-color: #eaeaea;
      border-radius: 4px;
      white-space: pre-wrap;
      overflow-wrap: break-word;
    }
    #answerSection {
      display: none;
      margin-top: 10px;
      background-color: #d0e6f6;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë²„íŠ¼ ëª¨ìŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .action-buttons {
      text-align: center;
      margin-top: 15px;
    }
    .action-buttons button {
      padding: 10px 15px;
      margin: 0 5px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #1c87c9;
      color: #fff;
    }
    .action-buttons button:hover {
      background-color: #155d8b;
    }

    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    #activity-loading-indicator {
      display: none;
      margin-top: 5px;
      text-align: center;
      font-size: 14px;
      color: red;
    }
    /* íšŒì „ ìŠ¤í”¼ë„ˆ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .spinner {
      margin: 0 auto 5px;
      width: 20px;
      height: 20px;
      border: 3px solid red;
      border-top: 3px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @media print {
      /* íƒ­ ë©”ë‰´ (ë¬¸ì œ ìƒì„±, ë¬¸ì œ í™•ì¸ ë²„íŠ¼) ìˆ¨ê¹€ */
      #tabs { display: none; }
      
      /* ì •ë‹µë³´ê¸°, ì¸ì‡„í•˜ê¸° ë²„íŠ¼ì´ í¬í•¨ëœ ì˜ì—­ ìˆ¨ê¹€ */
      .action-buttons { display: none; }
      
      /* í•„ìš”ì— ë”°ë¼ í—¤ë”/í‘¸í„° ë“±ë„ ìˆ¨ê¸¸ ìˆ˜ ìˆìŒ */
      header, footer { display: none; }
    }

    header p {
  font-size: 18px;
}
  </style>
</head>

<body>
  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í—¤ë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header>
    <h1>ğŸ’¡ ìœ¤ì„ ìƒ AI ì‹¤í—˜ì‹¤ ğŸ’¡</h1>
    <p>AI ê¸°ë°˜ ì˜ì–´ í•™ìŠµ ë„êµ¬</p>
  </header>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë©”ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main>
    <!-- íƒ­ ë©”ë‰´ -->
    <div id="tabs">
      <button id="tabCreate" class="tab-btn active">ë¬¸ì œ ìƒì„±</button>
      <button id="tabCheck"  class="tab-btn">ë¬¸ì œ í™•ì¸</button>
    </div>

    <!-- â”€â”€â”€â”€â”€ ë¬¸ì œ ìƒì„± ì„¹ì…˜ â”€â”€â”€â”€â”€ -->
    <section id="createSection" class="section active">
      <form id="grammarForm">
        <!-- í•™ë…„ ì„ íƒ -->
        <label for="grade">â‡ï¸ ì›í•˜ëŠ” í•™ë…„ ìˆ˜ì¤€ì„ ì„ íƒí•˜ì„¸ìš”.</label>
        <select id="grade">
          <option value="">-- í•™ë…„ --</option>
        </select>

        <!-- ë¬¸ë²• í•­ëª© ì„ íƒ -->
        <label for="grammarCategory">â‡ï¸ ë¬¸ë²• í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</label>
        <select id="grammarCategory">
          <option value="">-- ë¬¸ë²• í•­ëª© --</option>
        </select>

        <!-- ì„¸ë¶€ í•­ëª© ì„ íƒ -->
        <label for="grammarDetail">â‡ï¸ ì„¸ë¶€ í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</label>
        <select id="grammarDetail">
          <option value="">-- ì„¸ë¶€ í•­ëª© --</option>
        </select>

        <!-- ë¬¸í•­ ìˆ˜ ì„ íƒ -->
        <label for="questionCount">â‡ï¸ ë¬¸í•­ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</label>
        <select id="questionCount">
          <option value="0">-- ë¬¸í•­ ìˆ˜ -- </option>
          <option value="1">1ë¬¸í•­</option>
          <option value="2">2ë¬¸í•­</option>
          <option value="3">3ë¬¸í•­</option>
          <option value="5">5ë¬¸í•­</option>
          <option value="10">10ë¬¸í•­</option>
        </select>

     
<!-- ìƒì„± ë²„íŠ¼ ë°”ë¡œ ì•„ë˜ì— ë¡œë”© ì¸ë””ì¼€ì´í„° ìˆ˜ì • -->
<button type="submit">ë¬¸ì œ ìƒì„±</button>
<div id="activity-loading-indicator" style="display:none;">
  <div class="spinner"></div>
  <span>ë¬¸ì œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</span>
</div>

      </form>
    </section>

    <!-- â”€â”€â”€â”€â”€ ë¬¸ì œ í™•ì¸ ì„¹ì…˜ â”€â”€â”€â”€â”€ -->
    <section id="checkSection" class="section">
     <h2 id="reviewTitle" style="text-align:center;"></h2>
      <div id="output"></div>
      <div class="action-buttons">
        <button id="showAnswerBtn">ì •ë‹µë³´ê¸°</button>
        <button id="printBtn">ì¸ì‡„í•˜ê¸°</button>
      </div>
      <div id="answerSection"></div>
    </section>
  </main>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í‘¸í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer>
    <p>&copy; 2025 ìœ¤ì„ ìƒ AI ì‹¤í—˜ì‹¤. All rights reserved.</p>
    <img src="company-logo.png" alt="íšŒì‚¬ ë¡œê³ " style="height:40px;">
  </footer>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìŠ¤í¬ë¦½íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script>
    /* â”€â”€ 1. grammar.json ë¡œë“œ â”€â”€ */
    let grammarData = {};

    fetch('grammar.json')
      .then(res => res.json())
      .then(data => {
        grammarData = data;
        populateGrades();
      })
      .catch(err => console.error('ë¬¸ë²• ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', err));

    /* â”€â”€ 2. ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸° â”€â”€ */
    function populateGrades() {
      const gradeSelect = document.getElementById('grade');
      gradeSelect.innerHTML = '<option value="">-- í•™ë…„ ì„ íƒ --</option>';
      Object.keys(grammarData).forEach(grade => {
        const opt = document.createElement('option');
        opt.value = grade;
        opt.textContent = grade;
        gradeSelect.appendChild(opt);
      });
    }

    document.getElementById('grade').addEventListener('change', function () {
      const grade = this.value;
      populateGrammarCategories(grade);
      document.getElementById('grammarDetail').innerHTML = '<option value="">-- ì„¸ë¶€ í•­ëª© ì„ íƒ --</option>';
    });

    function populateGrammarCategories(grade) {
      const categorySelect = document.getElementById('grammarCategory');
      categorySelect.innerHTML = '<option value="">-- ë¬¸ë²• í•­ëª© ì„ íƒ --</option>';
      if (grammarData[grade]) {
        Object.keys(grammarData[grade]).forEach(cat => {
          const opt = document.createElement('option');
          opt.value = cat;
          opt.textContent = cat;
          categorySelect.appendChild(opt);
        });
      }
    }

    document.getElementById('grammarCategory').addEventListener('change', function () {
      const grade = document.getElementById('grade').value;
      const category = this.value;
      populateGrammarDetails(grade, category);
    });

    function populateGrammarDetails(grade, category) {
      const detailSelect = document.getElementById('grammarDetail');
      detailSelect.innerHTML = '<option value="">-- ì„¸ë¶€ í•­ëª© ì„ íƒ --</option>';
      if (grammarData[grade] && grammarData[grade][category]) {
        grammarData[grade][category].forEach(detail => {
          const opt = document.createElement('option');
          opt.value = detail;
          opt.textContent = detail;
          detailSelect.appendChild(opt);
        });
      }
    }

    /* â”€â”€ 3. íƒ­ ì „í™˜ â”€â”€ */
    const tabCreate = document.getElementById('tabCreate');
    const tabCheck  = document.getElementById('tabCheck');
    const createSection = document.getElementById('createSection');
    const checkSection  = document.getElementById('checkSection');

    tabCreate.addEventListener('click', () => {
      tabCreate.classList.add('active');
      tabCheck .classList.remove('active');
      createSection.classList.add('active');
      checkSection .classList.remove('active');
    });

    tabCheck.addEventListener('click', () => {
      tabCheck .classList.add('active');
      tabCreate.classList.remove('active');
      checkSection .classList.add('active');
      createSection.classList.remove('active');
    });

    /* â”€â”€ 4. ë¬¸í•­ ìƒì„± í¼ â”€â”€ */
    document.getElementById('grammarForm').addEventListener('submit', function (e) {
      e.preventDefault();
      generateQuestion();
    });

    function generateQuestion() {
      const grade = document.getElementById('grade').value;
      const category = document.getElementById('grammarCategory').value;
      const detail = document.getElementById('grammarDetail').value;
      const questionCount = document.getElementById('questionCount').value;

       // â† ì—¬ê¸°ì— ë¡œê·¸ ë„£ê¸°
  console.log("[Client] grade=", grade, "category=", category, "detail=", detail, "count=", questionCount);

      if (!grade || !category || !detail || !questionCount) {
        alert('í•™ë…„, ë¬¸ë²• í•­ëª©, ì„¸ë¶€ í•­ëª©, ë¬¸í•­ ìˆ˜ë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      const loader = document.getElementById('activity-loading-indicator');
      loader.style.display = 'block';

      fetch('https://grammar-worker.sehyunglee2015.workers.dev/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ grade, category, detail, questionCount })
      })
        .then(response => response.json())
        .then(data => {
          loader.style.display = 'none';
          const qText = data[0].question.trim();
          const aText = data[0].answer.trim();

          document.getElementById('reviewTitle').innerText = `${grade} / ${category} / ${detail}`;
          document.getElementById('output').innerText = qText;
          document.getElementById('answerSection').innerText = 'ì •ë‹µ ë° í•´ì„¤\n\n' + aText;
          document.getElementById('answerSection').style.display = 'none';

          tabCheck.click();
        })
        .catch(err => {
          loader.style.display = 'none';
          console.error('ë¬¸ì œ ìƒì„± Fetch ì˜¤ë¥˜:', err);
          document.getElementById('output').innerText = 'ë¬¸ì œ ìƒì„± ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        });
    }

    /* â”€â”€ 5. ì •ë‹µë³´ê¸° í† ê¸€ â”€â”€ */
    document.getElementById('showAnswerBtn').addEventListener('click', function () {
      const ansSec = document.getElementById('answerSection');
      if (ansSec.style.display === 'none') {
        ansSec.style.display = 'block';
        this.innerText = 'ì •ë‹µ ìˆ¨ê¸°ê¸°';
      } else {
        ansSec.style.display = 'none';
        this.innerText = 'ì •ë‹µë³´ê¸°';
      }
    });

    /* â”€â”€ 6. ì¸ì‡„í•˜ê¸° â”€â”€ */
    document.getElementById('printBtn').addEventListener('click', () => window.print());
  </script>
</body>
</html>
